<?php//set variables needed for email.$from = "wegottatalkbaby@optonline.net";$subject = "Responsible Choices Publishing Co. - File Location and Password";$msg_02 =  "Thank you for your purchase of from Responsible Choices Publishing Co.\n\nPlease keep this information in a safe place, as it contains pertinent information for obtaining the forms you have purchased.\n\nLink to file Notice of Pregnancy:\nhttp://www.wegottatalkbaby.com/paypal/np.pdf\n\nPassword:\n581486189001\n\nIf you have any problems, please contact us at wegottatalkbaby@optonline.net";$msg_03 =  "Thank you for your purchase from Responsible Choices Publishing Co.\n\nPlease keep this information in a safe place, as it contains pertinent information for obtaining the forms you have purchased.\n\nLink to file Response to Notice of Pregnancy:\nhttp://www.wegottatalkbaby.com/paypal/rnp.pdf\n\nPassword:\n\n\nIf you have any problems, please contact us at wegottatalkbaby@optonline.net";$msg_04 =  "Thank you for your purchase from Responsible Choices Publishing Co.\n\nPlease keep this information in a safe place, as it contains pertinent information for obtaining the forms you have purchased.\n\nLink to file Notice of Pregnancy:\nhttp://www.wegottatalkbaby.com/paypal/np.pdf\n\nPassword:\n581486189001\n\nLink to file Response to Notice of Pregnancy:\nhttp://www.wegottatalkbaby.com/paypal/rnp.pdf\n\nPassword:\n\n\nIf you have any problems, please contact us at wegottatalkbaby@optonline.net";// read the post from PayPal system and add 'cmd'$req = 'cmd=_notify-validate';foreach ($_POST as $key => $value) {$value = urlencode(stripslashes($value));$req .= "&$key=$value";}// post back to PayPal system to validate$header .= "POST /cgi-bin/webscr HTTP/1.0\r\n";$header .= "Content-Type: application/x-www-form-urlencoded\r\n";$header .= "Content-Length: " . strlen($req) . "\r\n\r\n";$fp = fsockopen ('www.paypal.com', 80, $errno, $errstr, 30);// assign posted variables to local variables$item_name = $_POST['item_name'];$item_number = $_POST['item_number'];$payment_status = $_POST['payment_status'];$payment_amount = $_POST['mc_gross'];$payment_currency = $_POST['mc_currency'];$txn_id = $_POST['txn_id'];$receiver_email = $_POST['receiver_email'];$payer_email = $_POST['payer_email'];$payment_date = $_POST['payment_date'];$first_name = $_POST['first_name'];$last_name = $_POST['last_name'];$payment_type = $_POST['payment_type'];$payment_gross = $_POST['payment_gross'];$payment_fee = $_POST['payment_fee'];$settle_amount = $_POST['settle_amount'];$memo = $_POST['memo'];$txn_type = $_POST['txn_type'];$payer_status = $_POST['payer_status'];$address_street = $_POST['address_street'];$address_city = $_POST['address_city'];$address_state = $_POST['address_state'];$address_zip = $_POST['address_zip'];$address_country = $_POST['address_country'];$address_status = $_POST['address_status'];$tax = $_POST['tax'];$option_name1 = $_POST['option_name1'];$option_selection1 = $_POST['option_selection1'];$option_name2 = $_POST['option_name2'];$option_selection2 = $_POST['option_selection2'];$for_auction = $_POST['for_auction'];$invoice = $_POST['invoice'];$subscr_id = $_POST['subscr_id'];if (!$fp) {// HTTP ERROR} else {fputs ($fp, $header . $req);while (!feof($fp)) {$res = fgets ($fp, 1024);if (strcmp ($res, "VERIFIED") == 0) {// check the payment_status is Completed// check that txn_id has not been previously processed// check that receiver_email is your Primary PayPal email// check that payment_amount/payment_currency are correct// process payment// if 'VERIFIED', send email	if ($item_number1 == 'RCP1101')	{mail($payer_email, $subject, "You ordered the book", "From: $from");}	elseif ($item_number1 == 'RCP1102')	{mail($payer_email, $subject, $msg_02, "From: $from");}	elseif ($item_number1 == 'RCP1103')	{mail($payer_email, $subject, $msg_03, "From: $from");}	elseif ($item_number1 == 'RCP1104')	{mail($payer_email, $subject, $msg_04, "From: $from");}	else 	{mail("remix.sakura@gmail.com", "Message 2", "$req", "From: $from");}}else if (strcmp ($res, "INVALID") == 0) {// log for manual investigation}  }fclose ($fp);}?>